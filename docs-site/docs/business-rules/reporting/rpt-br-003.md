---
id: "rpt-br-003"
title: "Customer statement generation"
domain: "reporting"
cobol_source: "CBTRN03C.cbl:158-374 (report generation pattern), CVACT01Y.cpy (account master — referenced)"
requirement_id: "RPT-BR-003"
regulations:
  - "FSA FFFS 2014:5 Ch. 3"
  - "PSD2 Art. 45"
  - "PSD2 Art. 57"
  - "GDPR Art. 15"
status: "extracted"
validated_by: null
validated_date: null
priority: "high"
---

# RPT-BR-003: Customer statement generation

## Summary

NordKredit AB generates monthly customer account statements as required by PSD2 (Art. 45/57 — information to payment service users) and FSA regulations. The statement generation batch runs after the monthly billing cycle closes, producing a formatted statement for each account showing the period's transactions, interest charges, fees, opening and closing balances, minimum payment due, and payment due date. The report generation pattern follows the same framework as CBTRN03C (daily transaction detail report) — sequential file processing, date-range filtering, lookup enrichment, and formatted output with control-break totals per account. The statement is the primary customer-facing financial document and must satisfy both regulatory disclosure requirements and GDPR data access rights. Extracted from the CBTRN03C.cbl report generation pattern and PSD2/FSA regulatory requirements.

## Business Logic

### Pseudocode

```
MONTHLY STATEMENT GENERATION BATCH:

    PRECONDITION: Monthly billing cycle has closed for the statement period

    INPUT FILES:
        TRANSACT    - Transaction master (all posted transactions)
        ACCTFILE    - Account master (balances, cycle dates, credit limit)
        CUSTFILE    - Customer master (name, address, contact details)
        CARDXREF    - Card cross-reference (card-to-account mapping)
        BILLFILE    - Billing records (interest charges, fees, minimum payment)
        DATEPARM    - Statement period (cycle start and end dates)

    OUTPUT FILES:
        STMTREPT    - Statement report file (one statement per account)

    PERFORM STATEMENT-GENERATION:
        Read statement period from DATEPARM

        FOR EACH active account in ACCTFILE (sorted by account ID):
            1. READ ACCOUNT HEADER DATA:
               Read account record for balances, credit limit, cycle dates
               Read customer record for name and mailing address

            2. WRITE STATEMENT HEADER:
               Customer name and address block
               Account number (masked: show last 4 digits only per GDPR)
               Statement period (cycle start to cycle end)
               Credit limit
               Previous balance (opening balance for period)

            3. READ AND LIST TRANSACTIONS:
               Filter TRANSACT file for this account's cards within period
               (Same date-range pattern as CBTRN03C:173-178)

               FOR EACH transaction in period:
                   Look up transaction type description (TRANTYPE)
                   Look up transaction category description (TRANCATG)
                   Write detail line:
                       Date | Description | Type | Amount
                   Accumulate transaction total
               END-FOR

            4. WRITE INTEREST AND FEES:
               Read billing record for this account
               Write interest charge line (from BILL-BR-001 disclosure group rate)
               Write fee lines (annual fee, late payment fee, etc.)

            5. WRITE STATEMENT SUMMARY:
               Previous balance
               + Purchases (total debits)
               + Interest charges
               + Fees
               - Payments/credits
               = New balance (closing balance)
               Minimum payment due (calculated per BILL-BR rules)
               Payment due date (cycle end + grace period)

            6. WRITE REGULATORY DISCLOSURES:
               Interest rate disclosure (PSD2 Art. 45)
               Fee schedule summary
               Dispute resolution contact information
               Ombudsman reference (FSA requirement)
        END-FOR

    SLA: Statements must be generated by day 3 of the following month
```

### Statement Structure

```
+------------------------------------------------------+
| NordKredit AB                                         |
| Kundtjänst: 0771-XX XX XX                           |
|                                                       |
| [Customer Name]                                       |
| [Address Line 1]                                      |
| [Address Line 2]                                      |
| [Postal Code] [City]                                  |
|                                                       |
| Kontonummer: **** **** **** 1234                      |
| Periodöversikt: 2026-01-01 till 2026-01-31           |
| Kreditgräns: 50,000.00 SEK                           |
+------------------------------------------------------+
| Datum       | Beskrivning          | Typ    | Belopp |
|-------------|----------------------|--------|--------|
| 2026-01-03  | ICA Maxi Solna       | Köp    | -450.00|
| 2026-01-05  | SJ Biljett           | Köp    | -890.00|
| 2026-01-15  | Betalning tack       | Bet    |+5000.00|
| ...         |                      |        |        |
+------------------------------------------------------+
| Föregående saldo                     |    12,340.00  |
| + Köp/uttag                          |     3,450.00  |
| + Ränta                              |       185.10  |
| + Avgifter                           |         0.00  |
| - Betalningar/krediteringar          |    -5,000.00  |
| = Nytt saldo                         |    10,975.10  |
|                                       |              |
| Minsta belopp att betala: 500.00 SEK                 |
| Förfallodatum: 2026-02-25                            |
+------------------------------------------------------+
| Räntesats: 18.99% (årsränta)                         |
| Vid frågor: kundtjanst@nordkredit.se                 |
| Konsumentverket: www.konsumentverket.se              |
+------------------------------------------------------+
```

### Decision Table

| Account Status | Transactions in Period | Balance | Statement Action |
|---|---|---|---|
| Active | Yes | > 0 | Full statement with transactions and summary |
| Active | No | > 0 | Statement with no transactions, balance carried forward |
| Active | No | = 0 | Statement with zero balance confirmation |
| Active | Yes | = 0 | Statement with transactions netting to zero |
| Closed | Any | > 0 | Final statement with closing balance |
| Closed | Any | = 0 | No statement (account fully settled) |
| Suspended | Any | Any | Statement with suspension notice |

## Source COBOL Reference

**Programs:** `CBTRN03C.cbl` (650 lines — report generation framework pattern)
**Copybooks:** `CVACT01Y.cpy` (account master — referenced, not in repo), `CVACT02Y.cpy` (card record), `CVACT03Y.cpy` (card cross-reference)

The statement generation follows the same patterns established in CBTRN03C:

**Date-range filtering** (CBTRN03C:173-178):
```cobol
000173                IF TRAN-PROC-TS (1:10) >= WS-START-DATE
000174                   AND TRAN-PROC-TS (1:10) <= WS-END-DATE
000175                   CONTINUE
000176                ELSE
000177                   NEXT SENTENCE
000178                END-IF
```

**Account grouping with control break** (CBTRN03C:158-217):
```cobol
         IF FD-TRANS-CARD-NUM NOT = WS-PREV-CARD-NUM
             IF WS-FIRST-RECORD = 'N'
                 PERFORM 1200-WRITE-ACCOUNT-TOTALS
             END-IF
             PERFORM 1300-LOOKUP-XREF
         END-IF
```

**Amount accumulation** (CBTRN03C:287-289):
```cobol
000287           ADD TRAN-AMT TO WS-PAGE-TOTAL
000288                           WS-ACCOUNT-TOTAL
```

**Note:** The dedicated statement generation COBOL program is not yet available in the repository. The statement generation logic is inferred from the CBTRN03C report framework, the account master structure (ACCT-BR-001), billing rules (BILL-BR-001 through BILL-BR-007), and PSD2 regulatory requirements.

## Acceptance Criteria

### Scenario 1: Full monthly statement generation

```gherkin
GIVEN the billing cycle for January 2026 has closed
  AND account "12345678901" has 15 transactions in the period
  AND the account has an opening balance of 12,340.00 SEK
WHEN the statement generation batch runs
THEN a statement is produced for account "12345678901"
  AND the statement lists all 15 transactions with dates, descriptions, and amounts
  AND the summary shows opening balance, transactions total, interest, fees, and closing balance
  AND the closing balance equals: opening + purchases + interest + fees - payments
```

### Scenario 2: Account number masking for GDPR

```gherkin
GIVEN account "12345678901" has card number "4000123456789012"
WHEN the statement is generated
THEN the card number is displayed as "**** **** **** 9012"
  AND the full account number is not printed on the statement
  AND the masked format satisfies GDPR data minimization (Art. 5(1)(c))
```

### Scenario 3: Interest rate disclosure per PSD2

```gherkin
GIVEN account "12345678901" belongs to disclosure group "STANDARD1"
  AND the applicable interest rate is 18.99% APR
WHEN the statement is generated
THEN the interest rate is disclosed on the statement as "18.99% (årsränta)"
  AND the interest charge amount is itemized separately
  AND the disclosure satisfies PSD2 Art. 45 requirements
```

### Scenario 4: Zero-balance statement

```gherkin
GIVEN account "98765432109" has no transactions in the period
  AND the account balance is 0.00 SEK
WHEN the statement generation batch runs
THEN a statement is generated confirming zero balance
  AND the statement header and regulatory disclosures are included
```

### Scenario 5: Statement SLA compliance

```gherkin
GIVEN the monthly billing cycle closes on January 31, 2026
WHEN the statement batch runs
THEN all statements are generated by February 3, 2026
  AND the batch completes within the SLA window
```

### Scenario 6: Customer data access request via statement

```gherkin
GIVEN a customer exercises their GDPR Art. 15 right of access
WHEN the bank retrieves statements for the customer
THEN all historical statements for the customer's accounts are available
  AND statements are retained for the regulatory retention period
  AND the data is provided in a commonly used electronic format
```

## Regulatory Mapping

| Regulation | Article/Section | Requirement | How This Rule Satisfies It |
|---|---|---|---|
| PSD2 | Art. 45 | Payment service providers must provide information on applicable charges and interest rates | Statement includes itemized interest charges and fee disclosure with applicable rates |
| PSD2 | Art. 57 | Information on individual payment transactions must be provided | Statement lists each transaction with date, description, type, and amount |
| FSA FFFS 2014:5 | Ch. 3 | Accurate and complete financial records | Statements provide period-accurate financial summaries reconcilable to transaction records |
| GDPR | Art. 15 | Data subject right of access to personal data | Statements serve as the primary channel for customers to access their transaction history and account status |
| GDPR | Art. 5(1)(c) | Data minimization | Card numbers masked on statements; only necessary PII included |

## Edge Cases

1. **Mid-cycle account closure**: If an account is closed mid-cycle, a final statement must be generated for the partial period showing the closing balance and any remaining charges. The statement must include instructions for paying the final balance.

2. **Multiple cards per account**: An account may have multiple linked cards (primary and supplementary). The statement must group transactions by card within the account, with sub-totals per card and a combined account total. The CBTRN03C card-change detection pattern (control break on card number) supports this grouping.

3. **Statement delivery channel**: The mainframe generates fixed-width text statements for print and mail. The migrated system should support multiple delivery channels: PDF for print, HTML for online banking, and structured data for open banking APIs (PSD2 AISP).

4. **Currency display**: All amounts are in SEK. The statement must use Swedish locale formatting (comma as decimal separator in printed statements, period in data exports). The COBOL PICTURE clause uses period as decimal separator; the migrated system must handle locale-specific formatting.

5. **Billing cycle misalignment**: If the billing cycle does not align with calendar months (e.g., cycle closes on the 25th), the statement period is cycle-to-cycle, not month-to-month. The date parameters must reflect the actual cycle dates from the account master record.

## Domain Expert Notes

- **null** (null): Awaiting domain expert review. CRITICAL QUESTIONS: (1) Is there a dedicated statement generation COBOL program, or are statements produced externally from CBTRN03C output? (2) What is the exact statement format — fixed-width text, or has it been modernized? (3) Are statements currently delivered by mail only, or is there an electronic delivery channel? (4) What is the grace period between cycle end and payment due date? (5) What is the minimum payment calculation formula (fixed amount, percentage of balance, or tiered)? (6) Are statements generated in Swedish only, or are other languages supported?

---

**Template version:** 1.0
**Last updated:** 2026-02-17
