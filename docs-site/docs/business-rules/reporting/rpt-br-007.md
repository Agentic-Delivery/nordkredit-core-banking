---
id: "rpt-br-007"
title: "Report output formatting and structure standards"
domain: "reporting"
cobol_source: "CBTRN03C.cbl:324-374 (header and detail line formatting)"
requirement_id: "RPT-BR-007"
regulations:
  - "FSA FFFS 2014:5 Ch. 3"
  - "FSA FFFS 2014:5 Ch. 7"
status: "extracted"
validated_by: null
validated_date: null
priority: "medium"
---

# RPT-BR-007: Report output formatting and structure standards

## Summary

All reports generated by the mainframe batch system follow a consistent formatting standard based on 133-character-wide records (132 data columns + 1 carriage control character for mainframe print control). CBTRN03C is the reference implementation: it uses named COBOL data structures for each report line type (header, column headers, separator, detail, page total, account total, grand total). The formatting conventions — fixed-width columns, dotted leaders for totals, COBOL PICTURE-clause-driven amount formatting, and multi-level control-break totals — form the reporting standard that all other batch reports follow. The migrated system must either preserve these formatting conventions (for backward-compatible output) or map them to modern equivalents (PDF, CSV, structured data). Extracted from `CBTRN03C.cbl` report output structures.

## Business Logic

### Pseudocode

```
REPORT FORMATTING STANDARDS:

    LINE WIDTH: 133 characters
        FD-REPTFILE-REC PIC X(133)
        Byte 1: Carriage control (mainframe print convention)
        Bytes 2-133: Report data

    REPORT HEADER (REPORT-NAME-HEADER):
        Field layout:
            REPT-SHORT-NAME     X(08)  - "DALYREPT" (report identifier)
            FILLER              X(12)  - spaces
            REPT-LONG-NAME      X(35)  - "Daily Transaction Report"
            FILLER              X(12)  - spaces
            REPT-DATE-HEADER    X(10)  - "Date Range"
            REPT-START-DATE     X(10)  - start date (YYYY-MM-DD)
            FILLER              X(05)  - " to "
            REPT-END-DATE       X(10)  - end date (YYYY-MM-DD)
            FILLER              X(13)  - spaces
        Total: 115 characters

    COLUMN HEADERS (TRANSACTION-HEADER-1):
        Field layout:
            "Transaction ID" (16 chars)
            "Account ID" (11 chars)
            "Transaction Type" (18 chars)
            "Tran Category" (30 chars)
            "Tran Source" (14 chars)
            "Amount" (15 chars)
        Total: 114 characters (with separating spaces)

    SEPARATOR LINE (TRANSACTION-HEADER-2):
        133 dash characters ('----...----')

    DETAIL LINE (TRANSACTION-DETAIL-REPORT):
        Field layout:
            TRAN-REPORT-TRANS-ID    X(16)  - Transaction ID
            FILLER                  X(01)  - space
            TRAN-REPORT-ACCOUNT-ID  X(11)  - Account ID
            FILLER                  X(01)  - space
            TRAN-REPORT-TYPE-CD     X(02)  - Type code
            FILLER                  X(01)  - dash
            TRAN-REPORT-TYPE-DESC   X(15)  - Type description
            FILLER                  X(01)  - space
            TRAN-REPORT-CAT-CD      9(04)  - Category code
            FILLER                  X(01)  - dash
            TRAN-REPORT-CAT-DESC    X(25)  - Category description
            FILLER                  X(01)  - space
            TRAN-REPORT-SOURCE      X(10)  - Transaction source
            FILLER                  X(01)  - space
            TRAN-REPORT-AMT         -ZZZ,ZZZ,ZZZ.ZZ  - Amount (15 chars)
        Total: 133 characters

    PAGE TOTAL LINE (REPORT-PAGE-TOTALS):
        "Page Total" + dotted leader + amount (+ZZZ,ZZZ,ZZZ.ZZ)
        Total: 111 characters

    ACCOUNT TOTAL LINE (REPORT-ACCOUNT-TOTALS):
        "Account Total" + dotted leader + amount (+ZZZ,ZZZ,ZZZ.ZZ)
        Total: 111 characters

    GRAND TOTAL LINE (REPORT-GRAND-TOTALS):
        "Grand Total" + dotted leader + amount (+ZZZ,ZZZ,ZZZ.ZZ)
        Total: 111 characters

    AMOUNT FORMATTING:
        Detail amounts:  -ZZZ,ZZZ,ZZZ.ZZ  (negative sign for debits)
        Total amounts:   +ZZZ,ZZZ,ZZZ.ZZ  (explicit sign for all totals)
        Zero suppression: leading zeros replaced with spaces (Z)
        Comma grouping: every 3 digits
        Decimal: fixed 2 places
        Precision: S9(09)V99 (signed, 9 integer, 2 decimal)

    PAGE CONTROL:
        WS-PAGE-SIZE = 20 (COMP-3)
        Page break: after every 20 detail lines
        New page: write page total, then write new header + column headers
        Carriage control: AFTER ADVANCING for line spacing
```

### Report Line Type Summary

| Line Type | COBOL Structure | Width (chars) | Spacing |
|---|---|---|---|
| Report header | REPORT-NAME-HEADER | 115 | AFTER ADVANCING PAGE (new page) |
| Column headers | TRANSACTION-HEADER-1 | 114 | AFTER ADVANCING 2 LINES |
| Separator | TRANSACTION-HEADER-2 | 133 | AFTER ADVANCING 1 LINE |
| Detail | TRANSACTION-DETAIL-REPORT | 133 | AFTER ADVANCING 1 LINE |
| Page total | REPORT-PAGE-TOTALS | 111 | AFTER ADVANCING 2 LINES |
| Account total | REPORT-ACCOUNT-TOTALS | 111 | AFTER ADVANCING 2 LINES |
| Grand total | REPORT-GRAND-TOTALS | 111 | AFTER ADVANCING 2 LINES |

### COBOL PIC Clause to .NET Type Mapping

| COBOL PIC | Purpose | .NET Type | Notes |
|---|---|---|---|
| X(nn) | Fixed-width text | string (padded) | Right-pad with spaces to width |
| 9(nn) | Unsigned numeric | int or long | Zero-pad to width for display |
| S9(09)V99 | Signed decimal | decimal(11,2) | Financial amounts, no float |
| -ZZZ,ZZZ,ZZZ.ZZ | Debit amount display | string format "-#,##0.00" | With zero suppression |
| +ZZZ,ZZZ,ZZZ.ZZ | Total amount display | string format "+#,##0.00" | With explicit sign |
| PIC 9(03) COMP-3 | Packed decimal (page size) | int | Packed BCD to integer |

## Source COBOL Reference

**Program:** `CBTRN03C.cbl`
**Lines:** 324-341 (header write), 361-374 (detail line write), 293-304 (page total write), 306-316 (account total write), 318-322 (grand total write)

Header write:
```cobol
000324       1100-WRITE-TRANSACTION-REPORT.
000325           IF WS-FIRST-TIME = 'Y'
000326               SET WS-FIRST-TIME-NO TO TRUE
000327               MOVE WS-START-DATE TO REPT-START-DATE
000328               MOVE WS-END-DATE TO REPT-END-DATE
000329               WRITE FD-REPTFILE-REC FROM REPORT-NAME-HEADER
000330                     AFTER ADVANCING PAGE
000331               WRITE FD-REPTFILE-REC FROM TRANSACTION-HEADER-1
000332                     AFTER ADVANCING 2 LINES
000333               WRITE FD-REPTFILE-REC FROM TRANSACTION-HEADER-2
000334                     AFTER ADVANCING 1 LINE
000335           END-IF
```

Detail line write:
```cobol
000361       1120-WRITE-DETAIL.
000362           INITIALIZE TRANSACTION-DETAIL-REPORT
000363           MOVE TRAN-ID TO TRAN-REPORT-TRANS-ID
000364           MOVE XREF-ACCT-ID TO TRAN-REPORT-ACCOUNT-ID
000365           MOVE TRAN-TYPE-CD OF TRAN-RECORD TO TRAN-REPORT-TYPE-CD
000366           MOVE TRAN-TYPE-DESC TO TRAN-REPORT-TYPE-DESC
000367           MOVE TRAN-CAT-CD OF TRAN-RECORD  TO TRAN-REPORT-CAT-CD
000368           MOVE TRAN-CAT-TYPE-DESC TO TRAN-REPORT-CAT-DESC
000369           MOVE TRAN-SOURCE TO TRAN-REPORT-SOURCE
000370           MOVE TRAN-AMT TO TRAN-REPORT-AMT
```

Grand total write:
```cobol
000318       1300-WRITE-GRAND-TOTALS.
000319           MOVE WS-GRAND-TOTAL TO GRAND-TOTAL-AMT
000320           WRITE FD-REPTFILE-REC FROM REPORT-GRAND-TOTALS
000321                 AFTER ADVANCING 2 LINES
000322           INITIALIZE REPORT-GRAND-TOTALS
```

## Acceptance Criteria

### Scenario 1: Report line width compliance

```gherkin
GIVEN the report output file uses 133-character records
WHEN any line is written to the report
THEN the line does not exceed 133 characters
  AND text fields are right-padded with spaces to their defined width
  AND numeric fields use zero-suppression (Z format)
```

### Scenario 2: Amount formatting with comma grouping

```gherkin
GIVEN a transaction amount of -1234567.89
WHEN the detail line is formatted
THEN the amount displays as "-1,234,567.89"
  AND comma grouping is applied every 3 digits
  AND exactly 2 decimal places are shown
  AND no rounding occurs during formatting
```

### Scenario 3: Page break and new headers

```gherkin
GIVEN the report has written 20 detail lines on the current page
WHEN the 21st detail line needs to be written
THEN a page total line is written for the 20 lines
  AND a new page header is written (report name + date range)
  AND column headers are written
  AND a separator line is written
  AND the detail line is then written on the new page
```

### Scenario 4: Dotted leader alignment for totals

```gherkin
GIVEN a page total of +12,345.67
WHEN the page total line is formatted
THEN the line reads "Page Total" followed by dots to fill the space
  AND the amount "+12,345.67" is right-aligned at the end
  AND the total line width is 111 characters
```

### Scenario 5: Carriage control for print compatibility

```gherkin
GIVEN the report is generated for mainframe print compatibility
WHEN the report header is written
THEN AFTER ADVANCING PAGE is used (form feed)
  AND column headers advance 2 lines after the report header
  AND detail lines advance 1 line (single-spaced)
  AND total lines advance 2 lines (double-spaced before totals)
```

### Scenario 6: Modern format equivalents

```gherkin
GIVEN the migrated system generates reports in PDF format
WHEN the report formatting is applied
THEN the column alignment matches the original 133-column layout
  AND amount formatting preserves comma grouping and sign conventions
  AND page breaks occur at the same 20-line intervals
  AND the PDF is verifiable against the original fixed-width output
```

## Regulatory Mapping

| Regulation | Article/Section | Requirement | How This Rule Satisfies It |
|---|---|---|---|
| FSA FFFS 2014:5 | Ch. 3 | Financial records must be accurate, legible, and maintained in an orderly manner | Consistent formatting standards ensure report legibility and orderly presentation |
| FSA FFFS 2014:5 | Ch. 7 | Reporting systems must produce reliable output | Deterministic formatting with fixed-width structures ensures reproducible report output |

## Edge Cases

1. **EBCDIC to Unicode text conversion**: COBOL text fields are stored in EBCDIC encoding. Swedish characters (å, ä, ö) in description fields must be correctly converted to UTF-8 in the migrated system. The formatting width (character count) remains the same, but byte count may differ for multi-byte UTF-8 characters.

2. **Amount overflow**: The COBOL PIC `-ZZZ,ZZZ,ZZZ.ZZ` supports amounts up to 999,999,999.99. If a total exceeds this range, the COBOL program may produce `***,***,***.** ` (asterisk overflow). The migrated system should handle larger amounts or raise an alert.

3. **Empty description fields**: If a transaction type or category description is empty (spaces in COBOL), the formatted line will have blank fields where descriptions should appear. The migrated system should consider showing the code alone or a "Unknown" placeholder.

4. **Carriage control obsolescence**: The mainframe carriage control character (byte 1) is specific to line printers. The migrated system producing PDF or HTML output does not need carriage control but must preserve equivalent spacing and page breaks.

5. **Report archival format**: Historical reports stored in the mainframe's fixed-width format must be accessible after migration. The migrated system should support reading legacy 133-character report files for comparison testing and historical access.

## Domain Expert Notes

- **null** (null): Awaiting domain expert review. QUESTIONS: (1) Are there other report programs that follow this same formatting standard, beyond CBTRN03C? (2) Is the 133-character width used consistently across all mainframe reports, or do some reports use different widths? (3) Should the migrated system produce both fixed-width text (for backward compatibility) and modern formats (PDF/CSV)? (4) Are there any reports that use different amount formatting conventions? (5) Is the dotted leader style for totals a business requirement or a cosmetic convention?

---

**Template version:** 1.0
**Last updated:** 2026-02-17
